%div[lmx, :machine_condition]
  %span= (lmx.condition.to_s == '') ? 'Click to enter machine description' : lmx.condition
  - if (!lmx.condition_date.nil?)
    %br/
    %br/
    %span= 'Updated: ' + lmx.condition_date.strftime("%d-%b-%Y")
%div[lmx, :machine_condition_edit]{:style => 'display:none'}
  = form_tag update_machine_condition_location_machine_xrefs_path(:action => 'update_machine_condition', :id => lmx.id, :region => @region.name), :id => "update_machine_condition_#{lmx.id}", :method => 'get' do
    = hidden_field_tag :id, lmx.id
    = text_area_tag "new_machine_condition_#{lmx.id}", (lmx.condition.to_s == '') ? '' : lmx.condition, :cols => 20, :rows => 3, :class => 'edit_mode', :placeholder => '(note: if this machine is gone, please just remove it. no need to leave a comment saying it is gone)'
    %br/
    = submit_tag 'Save', :id => "save_machine_condition_#{lmx.id}", :class => "save_button"
  = submit_tag 'Cancel', :id => "cancel_machine_condition_#{lmx.id}", :class => "cancel_button"

:javascript
  jQuery('#update_machine_condition_#{lmx.id}').submit(function () {
    jQuery('#machine_condition_display_#{lmx.id}').html(loadingHTML());

    var form = jQuery(this);
    jQuery.get(form.attr('action'), form.serialize(), function (data) {
      jQuery('#machine_condition_display_lmx_#{lmx.id}').load('/#{params[:region]}/location_machine_xrefs/#{lmx.id}/render_machine_condition');
    });

    return false;
  });

  jQuery('#cancel_machine_condition_#{lmx.id}, #machine_condition_lmx_#{lmx.id}').click(function () {
    jQuery('#machine_condition_edit_lmx_#{lmx.id}').toggle();
    jQuery('#machine_condition_lmx_#{lmx.id}').toggle();
  });

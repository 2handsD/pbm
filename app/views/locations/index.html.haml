- if (@locations)
  :javascript
    clearMarkers()
    clearInfoWindows();

    showLocations(
      [#{@location_data[0].join(', ')}],
      [#{@location_data[1].join(', ')}],
      [#{@location_data[2].join(', ')}],
      [#{@location_data[3].join(', ')}]
    );
  #results_container
    #search_results
      - @locations.each do |location|
        - l = location.clone
        %div.search_result[l]
          %div.sub_nav_location[l, :show_location_detail]{:onclick => "showLocationDetail(#{l.id});"}
            %ul
              %li.name= l.name
              - if (l.location_type)
                %li.location_type= " (#{l.location_type.name})"
              .clear
              %li.address
                %span.address_name[l, :location_summary] #{[l.street, l.city].join(' | ')}
                .clear
              %li.machine_names
                #{[l.machine_names].join('<br />').html_safe}
          .clear
          %div.location_detail[l, :location_detail]{:style => 'display:none'}
            %div.location_name{:onclick => "toggleArrows('location_detail', #{l.id}); locationLookupMapCenter(#{l.id});"}
              %ul
                %li.name= l.name
                - if (l.location_type)
                  %li.location_type= " (#{l.location_type.name})"
                .clear
                %li.address= [l.street, l.city, l.state + " " + l.zip].join(', ')
                .clear
                - if mobile_device? && !l.phone.nil?
                  %li.address= link_to l.phone, "tel:" + l.phone, :type => 'tel'
                - else
                  %li.address= l.phone
                .clear
                - if l.website
                  %li= link_to l.website, l.website, :class => 'address', :target => 'blank'
                  .clear
                %div[l, :desc]
                  = render :partial => 'locations/render_desc', :locals => {:l => l}
                .clear
            = render :partial => 'location_picture_xrefs/show_thumbs', :locals => {:location_picture_xrefs => l.location_picture_xrefs}
            %div.location_link
              =link_to 'Link to this map result', "/#{@region.name.downcase}/?by_location_id=#{l.id}", :id => l.id
            %accordion[l, :accordian]
              %accordion-group{"is-open" => "false"}
                %accordion-heading
                  %div[l,"add_picture_location_banner"]{"class"=>"sub_nav_item add_picture_location_toggle"}
                    %span ADD A PICTURE OF THIS LOCATION
                .add_picture_location
                  %span.info If you want to show others how this location looks and feels, feel free to upload a picture of it. Choose a file from your computer, then click 'upload'. Once the photo is approved, it will show up!
                  = render :partial => 'location_picture_xrefs/form',  :locals => {:location => l}
              %accordion-group{"is-open" => "false"}
                %accordion-heading
                  %div[l,"add_machine_location_banner"]{"class"=>"sub_nav_item add_machine_location_toggle"}
                    %span ADD NEW MACHINE TO THIS LOCATION
                %div[location, :add_machine]{:class => "add_machine_location"}
              %accordion-group{"is-open" => "false"}
                %accordion-heading
                  %div[l,"show_machines_location_banner"]{"class"=>"sub_nav_item show_machines_location_toggle"}
                    %span SHOW MACHINES AT THIS LOCATION
                %div[location, :show_machines]{:class => "show_machines_location"}
            :javascript
              angular.element(jQuery('#accordian_location_#{l.id}')).ready(function() {
                jQuery('#show_machines_location_#{l.id}').load('/#{params[:region]}/locations/#{l.id}/render_machines');
                jQuery('#add_machine_location_#{l.id}').load('/#{params[:region]}/locations/#{l.id}/render_add_machine', function() {
                  angular.bootstrap(jQuery('#accordian_location_#{l.id}'), ["pbm"]);
                });
              });

        - l = nil

    - if (@locations.size == 1)
      :javascript
        jQuery(function() {
          var locationID = #{@locations.first.id};
          showLocationDetail(locationID);

          jQuery('#show_machines_location_banner_location_' + locationID).click();
        });

- if (@locations)
  :javascript

    clearMarkers();
    clearInfoWindows();
    $("#mapFollow_wrapper,#search_link_wrapper,#min_lookup_wrapper").removeClass("hide_button");

    var hrefOrig = 'https://#{request.host_with_port}/#{@region.name.downcase}?';
    var def_value = window.location.href;
    if (typeof(search_string) == "undefined") {
      search_string = def_value;
      document.getElementById("search_link").href=search_string;
    } else {
      document.getElementById("search_link").href=hrefOrig + search_string;
    }

    showLocations(
      [#{@location_data[0].join(', ')}],
      [#{@location_data[1].join(', ')}],
      [#{@location_data[2].join(', ')}],
      [#{@location_data[3].join(', ').html_safe}]
    );

:javascript
  var isSingleLocation = #{@locations.size == 1 ? true : false}

  if (isSingleLocation) {
    var locationName = "#{raw @locations.size == 0 ? '' : @locations[0].name}";
    var locationAddress = "#{raw @locations.size == 0 ? '' : @locations[0].full_street_address}";
    var regionName = "#{raw @locations.size == 0 ? '' : @locations[0].region.full_name}";

    document.title = locationName + " - " + regionName + " Pinball Map";
    $('meta[name="description"]').attr("content", locationAddress + ". Play pinball at " + locationName + "!");
  } else {
    document.title = "#{title_for_path(request.path, @region)}";
    $('meta[name="description"]').attr("content", "#{desc_for_path(request.path, @region)}");
  }

#results_container
  #search_results   
    - @locations.each do |location|
      - l = location.clone
      %div.search_result[l]         
        - if (@locations.size == 1)
          %div.location_detail[l, :location_detail]
            = render :partial => 'locations/render_location_detail', :locals => {:l => l}
        - else
          %div.sub_nav_location[l, :show_location_detail]{:onclick => "showLocationDetail(#{l.id});"}
            %ul
              %li.name= l.name
              - if (!params[:show_location_distance].blank? && !params[:lat].blank? && !params[:lon].blank?)
                %li.location_types= " distance: #{l.distance_from([params[:lat], params[:lon]]).round(2)} miles"
              - if (l.location_type)
                %li.location_types= " (#{l.location_type.name})"
              .clear
              %li.address
                %span.address_name[l, :location_summary] #{[l.street, l.city].join(' | ')}
                .clear
              %li.machine_names
                #{[l.machine_names].join('<br />').html_safe}
          .clear
          %div.location_detail[l, :location_detail]{:style => 'display:none;'}

      - l = nil

  - if (@locations.size == 1)
    :javascript
      $(function() {
        locationLookupMapCenter(#{@locations.first.id});
      });
